{% extends "base.html" %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<div class="container mt-4">
  <h2 class="mb-4 text-center">Compare Identities: {{ project_name1 }} vs {{ project_name2 }}</h2>

  {% if matched_data %}
    {% for pair in matched_data %}
    <div class="card mb-5 shadow-sm">
      <div class="card-header bg-secondary text-white text-center">
        <h5>Identity "{{ pair.id1_name }}" ({{ project_name1 }}) vs "{{ pair.id2_name }}" ({{ project_name2 }})</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- Left identity -->
          <div class="col-md-6">
            <h6 class="text-center mb-3">Project 1 Sample</h6>
            <img src="{{ pair.id1_imgs_zipped.0.1|urlize }}" alt="Sample Image" class="img-fluid rounded mx-auto d-block mb-3 main-image" id="main-img-left-{{ forloop.counter }}" style="max-height: 300px; cursor: pointer; object-fit: contain;">
            <div class="d-flex flex-wrap justify-content-center gap-2 thumbnails" id="thumbs-left-{{ forloop.counter }}">
              {% for img, img_full in pair.id1_imgs_zipped %}
              <img src="{{ img_full|urlize }}" alt="Thumbnail" class="img-thumbnail thumb-image" style="width: 75px; height: 75px; object-fit: cover; cursor: pointer;" data-target="main-img-left-{{ forloop.parentloop.counter }}" />
              {% endfor %}
            </div>
          </div>

          <!-- Right identity -->
          <div class="col-md-6">
            <h6 class="text-center mb-3">Project 2 Sample</h6>
            <img src="{{ pair.id2_imgs_zipped.0.1|urlize }}" alt="Sample Image" class="img-fluid rounded mx-auto d-block mb-3 main-image" id="main-img-right-{{ forloop.counter }}" style="max-height: 300px; cursor: pointer; object-fit: contain;">
            <div class="d-flex flex-wrap justify-content-center gap-2 thumbnails" id="thumbs-right-{{ forloop.counter }}">
              {% for img, img_full in pair.id2_imgs_zipped %}
              <img src="{{ img_full|urlize }}" alt="Thumbnail" class="img-thumbnail thumb-image" style="width: 75px; height: 75px; object-fit: cover; cursor: pointer;" data-target="main-img-right-{{ forloop.parentloop.counter }}" />
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <p class="text-center text-muted">No matched identities found between these projects.</p>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // Thumbnail click updates main image
  document.querySelectorAll('.thumb-image').forEach(function(thumb) {
    thumb.addEventListener('click', function() {
      const targetId = this.getAttribute('data-target');
      const mainImg = document.getElementById(targetId);
      if (mainImg) {
        mainImg.src = this.src;
      }
    });
  });
});
</script>

<style>
  .main-image {
    border: 2px solid #dee2e6;
  }
  .thumb-image:hover {
    border-color: #0d6efd;
  }
</style>
{% endblock %}
